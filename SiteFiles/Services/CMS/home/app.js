var SessionInfo = function () { function t() { this.isCommentable = !0 } return t.prototype.init = function (t, e, i, n, o, r, s, l) { this.sn = t, this.templateSN = e, this.title = i, this.thumbUrl = n, this.imageUrl = o, this.summary = r, this.isCommentable = s, this.content = l }, t.prototype.initByAPI = function (t) { this.init(t.sn, t.templateSN, t.title, t.thumbUrl, t.imageUrl, t.summary, t.isCommentable, t.content) }, t }(), FormInfo = function () { function t() { } return t }(), StringUtils = function () { function t() { } return t.Text = { general: { tip_sn_error: "此内容已被作者删除或不存在", tip_login_first: "您还未登录，请登录后操作", tip_empty_comment: "请填写评论内容", tip_comfirm_delete: "此操作将删除内容，确定吗？", tip_success_delete: "内容已删除", tip_failure_private_code: "邀请码不正确，请重新输入", tip_error_email: "邮箱地址不正确，请重新输入", tip_third_login_error: "第三方登录失败", tip_success_change_password: "恭喜，密码修改成功", tip_success_unbinding: "第三方登录账号解绑成功", tip_success: "操作成功", btn_confirm: "确定", btn_cancel: "取消", app_name: "阁下", title_add: "新增", title_edit: "编辑" }, articleAdd: { title: "文章", tip_empty_title: "请填写标题", tip_empty_thumb_url: "请上传一幅图片作为文章封面", tip_empty_content: "请填写内容", tip_error_upload: "上传失败，只允许上传图片文件", tip_success_add: "恭喜，文章添加成功", tip_success_edit: "文章修改成功" }, activityAdd: { title: "活动", tip_empty_title: "请填写活动名称", tip_empty_location: "请填写活动地点", tip_empty_date: "请填写开始与结束时间", tip_empty_thumb_url: "请上传一幅图片作为活动海报", tip_empty_content: "请填写内容", tip_empty_form: "请填写报名表单字段名称", tip_error_upload: "上传失败，只允许上传图片文件", form_name_email: "邮箱", form_name_company: "单位", form_name_position: "职位", tip_empty_form_name: "请填写表单字段名称", btn_publish: "发布活动", btn_next: "下一步", tip_success_add: "恭喜，活动添加成功，快邀请小伙伴们报名吧", tip_success_edit: "活动修改成功" }, photoAdd: { title: "图片", tip_empty_title: "请填写图片名称", tip_empty_thumb_url: "请上传一幅图片", tip_error_upload: "上传失败，只允许上传图片文件", tip_success_add: "恭喜，图片添加成功", tip_success_edit: "图片修改成功", top_text: "头部文字", bottom_text: "底部文字" }, photoTemplate: { title: "选择图片模板" }, activity: { tip_empty_mobile: "请填写手机号码", tip_success_send_mobile_code: "验证码已发送到您手机", tip_error_mobile_code: "手机验证码不正确", btn_resend_mobile_code: "重新获取验证码", btn_waiting_mobile_code: "重新发送", btn_success_apply: "恭喜，活动报名成功" }, user: { title: "用户中心", title_postfix: " 发布的内容", tip_login_first: "您还未登录，请先登录阁下", menu_edit: "修改", menu_delete: "删除", menu_share: "分享", menu_send: "转发" }, userApply: { title: "报名查看" }, login: { tip_empty_login_name: "请填写登录账号", tip_empty_password: "请填写登录密码", tip_empty_user_name: "请填写用户名", tip_empty_gender: "请填写性别", tip_success_register: "恭喜，用户注册成功" }, setting: { title: "账户设置", tip_empty_displayName: "请填写您的显示名称", tip_empty_mobile: "请填写您的手机号码", tip_empty_email: "请填写您的邮箱地址", tip_empty_signature: "请填写签名", tip_success: "设置成功" } }, t.ThirdLoginType = { Weibo: "Weibo", QQ: "QQ", WeixinPC: "WeixinPC", WeixinMob: "WeixinMob" }, t }(), __extends = this.__extends || function (t, e) { function i() { this.constructor = t } for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]); i.prototype = e.prototype, t.prototype = new i }, ActivityInfo = function (_super) { function ActivityInfo() { _super.call(this), this.emailName = StringUtils.Text.activityAdd.form_name_email, this.companyName = StringUtils.Text.activityAdd.form_name_company, this.positionName = StringUtils.Text.activityAdd.form_name_position, this.formInfoList = [] } return __extends(ActivityInfo, _super), ActivityInfo.prototype.initActivityInfo = function (t, e, i, n, o, r, s, l, a, c, u, p, d, h, f, g, m) { this.location = t, this.latitudeAmount = e, this.longitudeAmount = i, this.startDate = n, this.endDate = o, this.maxCount = r, this.isTicket = s, this.ticketSummary = l, this.isEmail = a, this.emailName = c, this.isEmailRequired = u, this.isCompany = p, this.companyName = d, this.isCompanyRequired = h, this.isPosition = f, this.positionName = g, this.isPositionRequired = m, this.formInfoList = [] }, ActivityInfo.prototype.initActivityInfoByAPI = function (sessionInfo, extendInfo) { this.initByAPI(sessionInfo), this.initActivityInfo(extendInfo.location, extendInfo.latitudeAmount, extendInfo.longitudeAmount, extendInfo.startDate, extendInfo.endDate, extendInfo.maxCount, extendInfo.isTicket, extendInfo.ticketSummary, extendInfo.isEmail, extendInfo.emailName, extendInfo.isEmailRequired, extendInfo.isCompany, extendInfo.companyName, extendInfo.isCompanyRequired, extendInfo.isPosition, extendInfo.positionName, extendInfo.isPositionRequired), extendInfo.settings && (this.formInfoList = eval(extendInfo.settings)) }, ActivityInfo }(SessionInfo), AddPageInfo = function () { function t(t, e, i, n) { this.sn = t, this.title = e, this.currentPage = i, this.isUploadThumb = n } return t }(), PhotoInfo = function (t) { function e() { t.call(this) } return __extends(e, t), e.prototype.initPhotoInfo = function (t, e, i, n) { this.templateSN = t, e && (this.isTopText = !0, this.topText = e), i && (this.isMiddleText = !0, this.middleText = i), n && (this.isBottomText = !0, this.bottomText = n) }, e.prototype.initPhotoInfoByAPI = function (t, e) { this.initByAPI(t), this.thumbUrl = e.originalThumbUrl, this.imageUrl = e.originalImageUrl, this.initPhotoInfo(e.templateSN, e.topText, e.middleText, e.bottomText) }, e.prototype.initPhotoInfoByTemplateAPI = function (t) { this.templateSN = t.sn, this.imageUrl = t.imageUrl, this.thumbUrl = t.imageUrl, this.title = t.title, this.isTopText = !0, this.topText = t.topText || StringUtils.Text.photoAdd.top_text, this.isMiddleText = !1, this.isBottomText = !0, this.bottomText = t.bottomText || StringUtils.Text.photoAdd.bottom_text }, e }(SessionInfo), ReturnInfo = function () { function t(t, e) { this.isSuccess = t, this.errorMessage = e } return t }(), Utils = function () { function t() { } return t.isAnonymous = function () { return "YES" != $.cookie("GEXIA.LOGIN") }, t.setLoginStatus = function (t) { t ? $.cookie("GEXIA.LOGIN", "YES", { expires: 7, path: "/", secure: !1 }) : $.cookie("GEXIA.LOGIN", "", { expires: 7, path: "/", secure: !1 }) }, t.render = function (e, i, n) { if (t.unLoading(), n) { $(".ID_" + n + "_HTML").remove(); var o = $("#" + n).attr("path"), r = template(o, i), s = $("<div>" + r + "</div>"); s.children().addClass(e + "HTML"), s.children().addClass("ID_" + n + "_HTML"), $("#" + n).after(s.html()) } else $("." + e + "_HTML").remove(), $("." + e).each(function () { var t = $(this).attr("id"), n = $(this).attr("path"), o = template(n, i), r = $("<div>" + o + "</div>"); r.children().addClass(e + "_HTML"), t && r.children().addClass("ID_" + t + "_HTML"), $(this).after(r.html()) }); $(".btn_create").click(function () { t.mask(), $("#popCreate").show() }), $("#popCreate .btn-default").click(function () { t.unMask(), $("#popCreate").hide() }) }, t.headroom = function () { $(".headroom").length > 0 && $(".headroom").headroom({ tolerance: 0, offset: 200, classes: { initial: "animated", pinned: "slideDown", unpinned: "slideUp" } }), $(".j_footer_fixed").length > 0 && $(".j_footer_fixed").headroom({ tolerance: 0, offset: 200, classes: { initial: "animated", pinned: "slide--reset", unpinned: "slide--down" } }) }, t.iCheck = function () { $("input:checkbox, input:radio").on("ifCreated ifClicked ifChanged ifChecked ifUnchecked ifDisabled ifEnabled ifDestroyed", function () { }).iCheck({ checkboxClass: "icheckbox_flat-red", radioClass: "iradio_flat-red", increaseArea: "20%" }) }, t.fileUpload = function (e, i, n) { $("#" + e).attr("data-url", i), $("#" + e).fileupload({ dataType: "json", acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i, maxFileSize: 5e6, xhrFields: { withCredentials: !0 }, type: "POST", add: function (e, i) { t.loading(), i.submit() }, done: function (e, i) { t.unLoading(), i.result.isSuccess ? n(i.result) : t.alertError(i.result.errorMessage) } }) }, t.umEditor = function (t) { return UM.getEditor(t, { toolbar: ["undo redo | bold italic underline | justifyleft justifycenter justifyright justifyjustify | horizontal"] }) }, t.changeTitle = function (t) { $("title, #title").text(t) }, t.scrollTo = function (t) { $("html,body").animate({ scrollTop: $("#" + t).offset().top }, 1e3) }, t.getDate = function (t) { return t.substr(0, t.indexOf("T")) }, t.getDateTime = function (t) { return t.substr(0, t.indexOf("T")) + " " + t.substr(t.indexOf("T") + 1) }, t.alertSuccess = function (e, i) { t.unLoading(), swal({ title: e, type: "success" }, i) }, t.alertError = function (e, i) { t.unLoading(), swal({ title: e, type: "error" }, i) }, t.pop = function (t, e, i) { $("#pop .bd").html(t), $("#pop").show(), $(".mask").show(), $(".mask").click(function () { $("#pop").hide(), $(".mask").hide() }), e ? ($("#pop #ft").show(), $("#pop #btnPop").text(e), $("#pop #btnPop").click(function () { i ? i() : ($("#pop").hide(), $(".mask").hide()) })) : ($("#pop #ft").hide(), $("#pop #btnPop").click(function () { $("#pop").hide(), $(".mask").hide() })) }, t.unPop = function () { t.unLoading(), $(".pop_modal").hide() }, t.confirm = function (e, i) { t.unLoading(), swal({ title: e, type: "warning", showCancelButton: !0, confirmButtonColor: "#DD6B55", cancelButtonText: StringUtils.Text.general.btn_cancel, confirmButtonText: StringUtils.Text.general.btn_confirm }, i) }, t.unConfirm = function () { t.unLoading(), $("#confirm").hide() }, t.mask = function () { $(".mask").show() }, t.unMask = function () { $(".mask").hide() }, t.loading = function () { t.unPop(), t.unConfirm(), t.mask(), $("#loading").css("top", $(window).scrollTop() + $(window).height() / 3).show() }, t.unLoading = function () { t.unMask(), $("#loading").hide() }, t.random = function () { return Math.floor(1e3 * Math.random()) }, t.isEmail = function (t) { return /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(t) }, t.isMobile = function (t) { return /^0{0,1}1[0-9]{10}$/.test(t) }, t.ajaxGet = function (e, i, n) { $.ajax({ url: i, type: "GET", data: e, dataType: "json", xhrFields: { withCredentials: !0 }, crossDomain: !0 }).done(function (t) { n(t) }).fail(function (e) { t.alertError(JSON.stringify(e)) }) }, t.ajaxPost = function (e, i, n) { $.ajax({ url: i, type: "POST", data: e, dataType: "json", xhrFields: { withCredentials: !0 }, crossDomain: !0 }).done(function (t) { n(t) }).fail(function (e) { t.alertError(JSON.stringify(e)) }) }, t.ajaxDelete = function (e, i, n) { $.ajax({ url: i, type: "DELETE", data: e, dataType: "json", xhrFields: { withCredentials: !0 }, crossDomain: !0 }).done(function (t) { n(t) }).fail(function (e) { t.alertError(JSON.stringify(e)) }) }, t.ajaxPut = function (e, i, n) { $.ajax({ url: i, type: "PUT", data: e, dataType: "json", xhrFields: { withCredentials: !0 }, crossDomain: !0 }).done(function (t) { n(t) }).fail(function (e) { t.alertError(JSON.stringify(e)) }) }, t.toJSON = function (t) { return $.parseJSON(JSON.stringify(t)) }, t.isPc = function () { for (var t = navigator.userAgent, e = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"], i = !0, n = 0; n < e.length; n++) if (t.indexOf(e[n]) > 0) { i = !1; break } return i }, t.isWeiXin = function () { var t = navigator.userAgent.toLowerCase(); try { return "micromessenger" == t.match(/MicroMessenger/i)[0] ? !0 : !1 } catch (e) { return !1 } }, t.detectIE = function () { var t = window.navigator.userAgent, e = t.indexOf("MSIE "), i = t.indexOf("Trident/"); if (e > 0) return parseInt(t.substring(e + 5, t.indexOf(".", e)), 10); if (i > 0) { var n = t.indexOf("rv:"); return parseInt(t.substring(n + 3, t.indexOf(".", n)), 10) } return 0 }, t }(), UrlUtils = function () { function t() { } return t.getAPI = function (e, i, n) { return n ? t.apiUrl + e + "/" + i + "/" + n : t.apiUrl + e + "/" + i }, t.getAbsoluteUrl = function (t) { return "http://" + window.location.hostname.toLowerCase() + "/" + t.replace(/(^\/*)|(\/*$)/g, "") }, t.getReturnUrl = function (t) { var e = new RegExp("(^|&)returnUrl=([^&]*)(&|$)"), i = window.location.search.substr(1).match(e); return null != i ? decodeURIComponent(i[2]) : t || "/index.html" }, t.getViewUrl = function (t, e) { return "/static/" + t + ".html?sn=" + e }, t.getUrlVar = function (t) { var e = new RegExp(t + "=([^&]*)", "i").exec(window.location.search); return e && decodeURIComponent(e[1]) || "" }, t.getSessionType = function () { return t.getUrlVar("sessionType") }, t.getSN = function () { return t.getUrlVar("sn") }, t.isSN = function () { return t.getSN() ? !0 : !1 }, t.getToken = function () { return t.getUrlVar("token") }, t.isToken = function () { return t.getToken() ? !0 : !1 }, t.redirectToReturnUrl = function (e) { location.href = t.getReturnUrl(e) }, t.redirect = function (t) { location.href = t }, t.redirectToIndex = function () { t.redirect("/index.html") }, t.redirectToView = function (e, i) { t.redirect("/static/" + e + ".html?sn=" + i) }, t.redirectToEdit = function (e, i) { t.redirect("/static/" + e + "Add.html?sn=" + i) }, t.redirectToLogin = function (e) { e = e || window.location.href, t.redirect("/static/login.html?returnUrl=" + e) }, t.redirectToLoginToBind = function (e, i) { t.redirect("/static/login.html?isBind=true&sessionType=" + e + "&sn=" + i) }, t.redirectToUser = function (e) { t.redirect("/static/user.html" + (e ? "?sn=" + e : "")) }, t.redirectToActivityTicket = function (e, i) { t.redirect("/static/activityTicket.html?sn=" + e + "&applyID=" + i) }, t.getThirdLoginUrl = function (t, e, i) { return i ? "http://gexia.com/home/authLogin.html?isStart=true&loginType=" + t + "&userID=" + i + "&returnUrl=" + e : "http://gexia.com/home/authLogin.html?isStart=true&loginType=" + t + "&returnUrl=" + e }, t.reload = function () { location.reload(!0) }, t.apiUrl = "http://api.gexia.com/", t }(), AuthService = function () { function t() { } return t.prototype.getUrl = function (t, e) { return UrlUtils.getAPI("auth", t, e) }, t.prototype.getJsonpUrl = function (t, e) { return UrlUtils.getAPI("authJsonp", t, e) }, t.prototype.getWeiXinJsonpUrl = function (t, e) { return UrlUtils.getAPI("WeiXinAuth", t, e) }, t.prototype.getAuth = function (t) { Utils.ajaxGet({}, this.getJsonpUrl("GetAuth"), t) }, t.prototype.getAuthParameter = function (t, e) { var i = { token: t }; Utils.ajaxPost(i, this.getUrl("GetAuthParameter"), e) }, t.prototype.getAuthPublishmentSystem = function (t) { Utils.ajaxGet({}, this.getJsonpUrl("GetAuthPublishmentSystem"), t) }, t.prototype.getAuthThirdLoginBindingInfoList = function (t) { Utils.ajaxGet({}, this.getJsonpUrl("GetAuthThirdLoginBindingInfoList"), t) }, t.prototype.login = function (t, e, i) { var n = { loginName: t, password: e }; Utils.ajaxGet(n, this.getJsonpUrl("Login"), function (t) { t.isSuccess && Utils.setLoginStatus(!0), i(t) }) }, t.prototype.register = function (t, e, i) { var n = { loginName: t, password: e, userFrom: "app" }; Utils.ajaxGet(n, this.getJsonpUrl("Register"), i) }, t.prototype.forgetPassword = function (t, e) { var i = { email: t }; Utils.ajaxGet(i, this.getJsonpUrl("ForgetPassword"), e) }, t.prototype.changePassword = function (t, e, i) { var n = { currentPassword: t, newPassword: e }; Utils.ajaxGet(n, this.getJsonpUrl("ChangePassword"), i) }, t.prototype.logout = function (t) { Utils.ajaxGet({}, this.getJsonpUrl("Logout"), function (e) { Utils.setLoginStatus(!1), t(e) }) }, t.prototype.getAvatorUploadUrl = function () { return this.getUrl("AvatorUpload") }, t.prototype.updateAuthAttribute = function (t, e, i) { var n = { attributeName: t, value: e }; Utils.ajaxPost(n, this.getUrl("UpdateAuthAttribute"), i) }, t.prototype.updateAuth = function (t, e, i, n, o) { var r = { email: t, displayName: e, gender: i, signature: n }; Utils.ajaxPost(r, this.getUrl("UpdateAuth"), o) }, t.prototype.sendMobileCode = function (t, e) { var i = { mobile: t }; Utils.ajaxPost(i, this.getUrl("SendMobileCode"), e) }, t.prototype.getThirdLoginAuthUrl = function (t, e, i, n) { var o = { userID: t, loginType: e, returnUrl: i }; Utils.ajaxGet(o, this.getJsonpUrl("GetThirdLoginAuthUrl"), function (t) { n(t) }) }, t.prototype.getThirdLoginAuthInfo = function (t, e, i) { var n = { authKey: t, code: e }; Utils.ajaxGet(n, this.getJsonpUrl("GetThirdLoginAuthInfo"), function (t) { i(t) }) }, t.prototype.thirdLoginUnBinding = function (t, e) { var i = { loginType: t }; Utils.ajaxGet(i, this.getJsonpUrl("ThirdLoginUnBinding"), function (t) { e(t) }) }, t.prototype.getWeixinAuthUrl = function (t, e, i, n) { var o = { userID: t, loginType: e, returnUrl: i }; Utils.ajaxGet(o, this.getWeiXinJsonpUrl("GetAuthUrl"), function (t) { n(t) }) }, t.prototype.getWeixinAuthInfo = function (t, e, i) { var n = { authKey: t, code: e }; Utils.ajaxGet(n, this.getWeiXinJsonpUrl("GetAuthInfo"), function (t) { i(t) }) }, t }(), CentralService = function () { function t() { } return t.prototype.getUrl = function (t, e) { return UrlUtils.getAPI("central", t, e) }, t.prototype.getIndexSessionList = function (t) { var e = {}; Utils.ajaxGet(e, this.getUrl("GetIndexSessionList"), t) }, t.prototype.getTemplate = function (t, e) { var i = { sn: t }; Utils.ajaxGet(i, this.getUrl("GetTemplate"), e) }, t.prototype.getTemplateList = function (t, e) { var i = { templateType: t }; Utils.ajaxGet(i, this.getUrl("GetTemplateList"), e) }, t }(), NoticeService = function () { function t() { } return t.prototype.getUrl = function (t, e) { return UrlUtils.getAPI("notice", t, e) }, t.prototype.getNoticeInfoList = function (t, e) { var i = { noticeType: t }; Utils.ajaxGet(i, this.getUrl("GetNoticeInfoList"), e) }, t }(), SessionService = function () { function t() { } return t.prototype.getUrl = function (t, e) { return UrlUtils.getAPI("session", t, e) }, t.prototype.submitArticle = function (t, e) { Utils.ajaxPost(Utils.toJSON(t), this.getUrl("SubmitArticle"), e) }, t.prototype.submitActivity = function (t, e) { var i = JSON.stringify(t.formInfoList); t.settings = i, Utils.ajaxPost(Utils.toJSON(t), this.getUrl("SubmitActivity"), e) }, t.prototype.submitPhoto = function (t, e) { Utils.ajaxPost(Utils.toJSON(t), this.getUrl("SubmitPhoto"), e) }, t.prototype.submitH5Show = function (t, e) { Utils.ajaxPost(Utils.toJSON(t), this.getUrl("SubmitH5Show"), e) }, t.prototype.bindSession = function (t, e) { var i = { sn: t }; Utils.ajaxPost(i, this.getUrl("BindSession"), e) }, t.prototype.getSessionToView = function (t, e) { var i = { sn: t }; Utils.ajaxGet(i, this.getUrl("GetSessionToView"), e) }, t.prototype.getSessionToEdit = function (t, e, i) { var n = { sn: t, isOwn: e }; Utils.ajaxGet(n, this.getUrl("GetSessionToEdit"), i) }, t.prototype.getUserSessionList = function (t, e, i) { var n = { token: t, type: e }; Utils.ajaxGet(n, this.getUrl("GetUserSessionList"), i) }, t.prototype.getUserLikedSessionList = function (t, e) { var i = { token: t }; Utils.ajaxGet(i, this.getUrl("GetUserLikedSessionList"), e) }, t.prototype.submitLike = function (t, e) { var i = { sn: t }; Utils.ajaxPost(i, this.getUrl("SubmitLike"), e) }, t.prototype.submitComment = function (t, e, i, n) { var o = { sn: t, content: e, commentCount: i }; Utils.ajaxPost(o, this.getUrl("SubmitComment"), n) }, t.prototype.deleteSession = function (t, e) { var i = { sn: t }; Utils.ajaxPost(i, this.getUrl("DeleteSession"), e) }, t.prototype.getUploadUrl = function () { return this.getUrl("Upload") }, t.prototype.submitApply = function (t, e, i, n, o, r, s, l) { var a = { sn: t, mobile: e, realName: i, email: n, company: o, position: r, attributeValues: JSON.stringify(s) }; Utils.ajaxPost(a, this.getUrl("SubmitApply"), l) }, t.prototype.getApplyList = function (t, e) { var i = { sn: t }; Utils.ajaxGet(i, this.getUrl("GetApplyList"), e) }, t.prototype.getActivityTicket = function (t, e, i) { var n = { sn: t, applyID: e }; Utils.ajaxGet(n, this.getUrl("GetActivityTicket"), i) }, t.prototype.exportApply = function (t, e, i) { var n = { sn: t, email: e }; Utils.ajaxPost(n, this.getUrl("ExportApply"), i) }, t }(), ShareUtils = function () { function t(t, e, i, n) { this.title = t, this.img_url = e, this.link = i, this.desc = n, this.link = UrlUtils.getAbsoluteUrl(this.link) } return t.prototype.sendAppMessage = function () { WeixinJSBridge.invoke("sendAppMessage", { img_url: this.img_url, img_width: "120", img_height: "120", link: this.link, desc: this.desc, title: this.title }, function () { }) }, t.prototype.shareTimeline = function () { WeixinJSBridge.invoke("shareTimeline", { img_url: this.img_url, img_width: "120", img_height: "120", link: this.link, desc: this.desc, title: this.title }, function () { }) }, t.prototype.pageLoad = function () { var t = this; document.addEventListener("WeixinJSBridgeReady", function () { WeixinJSBridge.on("menu:share:appmessage", function () { t.sendAppMessage() }), WeixinJSBridge.on("menu:share:timeline", function () { t.shareTimeline() }) }, !1), $("#btnShare").click(function () { return Utils.mask(), $("#popShare").show(), !1 }), $("#popShare a").click(function () { $("#popShare").hide(), Utils.unMask() }), $("#popShare .share_weixin").click(function () { Utils.mask(), $("#qrCode").html() || $("#qrCode").qrcode({ width: 200, height: 200, text: location.href }), $("#popQRCode").show() }), $("#popQRCode .btn-default").click(function () { $("#popQRCode").hide(), Utils.unMask() }), window._bd_share_config = { common: { bdText: this.desc, bdDesc: this.desc, bdUrl: this.link, bdPic: this.img_url }, share: [{ bdSize: 16 }] }, $.getScript("http://bdimg.share.baidu.com/static/api/js/share.js"); var e = setInterval(function () { $("#divShareIcons").hasClass("bdshare-button-style0-16") && ($("#divShareIcons").removeClass("bdshare-button-style0-16").show(), clearInterval(e)) }, 1e3) }, t }(), BaseController = function () { function t(t, e) { this.pageName = t, this.pageTitle = e, this.authService = new AuthService, this.sessionService = new SessionService, this.centralService = new CentralService, this.noticeService = new NoticeService } return t.prototype.render = function (t, e, i) { var n = this; this.authService.getAuth(function (o) { n.pageInfo = new PageInfo(n.pageName, n.pageTitle, o.isAnonymous, o.auth), o.isAnonymous ? HomeUrlUtils.redirectToLogin() : (t = $.extend({}, n.pageInfo, t), HomeUtils.render("public", t), $(".dropdown-toggle").dropdown(), $("#btnLogout").click(function () { n.authService.logout(function () { HomeUrlUtils.redirectToLogin() }) }), HomeUtils.loading(), HomeUtils.render(n.pageName, t, e), i && i()) }) }, t }(), AccountController = function (t) { function e(e) { t.call(this, e) } return __extends(e, t), e.prototype.init = function () { var t = this; "binding" == this.pageName ? this.authService.getAuthThirdLoginBindingInfoList(function (e) { e.thirdLoginUrlWeibo = UrlUtils.getThirdLoginUrl(StringUtils.ThirdLoginType.Weibo, HomeUrlUtils.getAbsoluteUrl("/home/accountBinding.html"), e.userID), e.thirdLoginUrlQQ = UrlUtils.getThirdLoginUrl(StringUtils.ThirdLoginType.QQ, HomeUrlUtils.getAbsoluteUrl("/home/accountBinding.html"), e.userID), e.thirdLoginUrlWeixinPC = UrlUtils.getThirdLoginUrl(StringUtils.ThirdLoginType.WeixinPC, HomeUrlUtils.getAbsoluteUrl("/home/accountBinding.html"), e.userID), t.render(e, null, function () { $("#btnUnBindingWeibo").click(function () { t.thirdLoginUnBinding(StringUtils.ThirdLoginType.Weibo) }), $("#btnUnBindingQQ").click(function () { t.thirdLoginUnBinding(StringUtils.ThirdLoginType.QQ) }), $("#btnUnBindingWeixinPC").click(function () { t.thirdLoginUnBinding(StringUtils.ThirdLoginType.WeixinPC) }) }) }) : "setting" == this.pageName ? this.render(null, null, function () { $("#fileupload").attr("data-url", t.authService.getAvatorUploadUrl()), $("#fileupload").fileupload({ dataType: "json", acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i, maxFileSize: 5e6, xhrFields: { withCredentials: !0 }, add: function (t, e) { Utils.loading(), e.submit() }, done: function (t, e) { Utils.unLoading(); var i = e.result; i.isSuccess ? UrlUtils.reload() : Utils.alertError(i.errorMessage) } }), $("#btnUpload").click(function () { $("#fileupload").click() }), $("#frmSetting").submit(function () { return t.updateAccount(), !1 }) }) : "password" == this.pageName && this.render(null, null, function () { $("#frmPassword").submit(function () { return t.changePassword(), !1 }) }) }, e.prototype.updateAccount = function () { var t = $("#tbEmail").val(), e = $("#tbDisplayName").val(), i = $("#ddlGender").val(), n = $("#tbSignature").val(); return t ? void this.authService.updateAuth(t, e, i, n, function (t) { t.isSuccess ? Utils.alertSuccess(StringUtils.Text.setting.tip_success, function () { UrlUtils.reload() }) : Utils.alertError(t.errorMessage) }) : void Utils.alertError(StringUtils.Text.setting.tip_empty_email, function () { $("#tbEmail").focus() }) }, e.prototype.changePassword = function () { var t = $("#currentPassword").val(), e = $("#newPassword").val(), i = $("#confirmNewPassword").val(); return e ? e != i ? void Utils.alertError(HomeStringUtils.Text.account.tip_comfirm_password_error, function () { $("#confirmNewPassword").focus() }) : void this.authService.changePassword(t, e, function (t) { t.isSuccess ? Utils.alertSuccess(StringUtils.Text.general.tip_success_change_password, function () { HomeUrlUtils.redirectToIndex() }) : Utils.alertError(t.errorMessage) }) : void Utils.alertError(HomeStringUtils.Text.account.tip_new_password_empty, function () { $("#newPassword").focus() }) }, e.prototype.thirdLoginUnBinding = function (t) { this.authService.thirdLoginUnBinding(t, function (t) { t.isSuccess && Utils.alertSuccess(StringUtils.Text.general.tip_success_unbinding, function () { UrlUtils.reload() }) }) }, e }(BaseController), AuthLoginController = function () { function t() { this.authService = new AuthService, this.sessionService = new SessionService, this.centralService = new CentralService } return t.prototype.init = function () { var t = this; Utils.render("public", {}), $(".pop_modal").hide(), $("#confirm").hide(), $(".mask").show(), $("#loadingblack").show(); var e = UrlUtils.getUrlVar("isWeixin"); if (e) { $(".sweet-overlay").css("background-color", "#fff"), $.cookie("SITESERVER.AUTH.WEIXIN", e, { expires: 7, path: "/", secure: !1 }); var i = UrlUtils.getUrlVar("loginType"), n = UrlUtils.getUrlVar("returnUrl"), o = UrlUtils.getUrlVar("PublishmentSystemID"); return $.cookie("SITESERVER.AUTH.PUBLISHMENTSYSTEMID", o, { expires: 7, path: "/", secure: !1 }), void this.redirectToAuthUrl("0", i, n) } var r = $.cookie("SITESERVER.AUTH.WEIXIN"); if (r) { $(".sweet-overlay").css("background-color", "#fff"); var s = $.cookie("SITESERVER.AUTH.WEIXINKEY"), l = UrlUtils.getUrlVar("code"), a = $.cookie("SITESERVER.AUTH.PUBLISHMENTSYSTEMID"); return this.authService.getWeixinAuthInfo(s, l, function (t) { 1 == t.isSuccess ? UrlUtils.redirect(t.returnUrl + "&uniqueID=" + t.uniqueID + "&publishmentSystemID=" + a) : Utils.alertError(t.errorMessage) }), $.cookie("SITESERVER.AUTH.WEIXIN", "", { expires: -1 }), $.cookie("SITESERVER.AUTH.PUBLISHMENTSYSTEMID", "", { expires: -1 }), void $.cookie("SITESERVER.AUTH.WEIXINKEY", "", { expires: -1 }) } var c = UrlUtils.getUrlVar("isStart"); if (c) { var u = UrlUtils.getUrlVar("userID"), i = UrlUtils.getUrlVar("loginType"), n = UrlUtils.getUrlVar("returnUrl"); return void this.redirectToThirdLoginAuthUrl(u, i, n) } var s = $.cookie("GEXIA.THIRDLOGIN.AUTH"), l = UrlUtils.getUrlVar("code"); this.authService.getThirdLoginAuthInfo(s, l, function (e) { 1 == e.isSuccess ? t.submitLogin(e.userName, e.password, e.returnUrl) : Utils.alertError(e.errorMessage) }) }, t.prototype.redirectToAuthUrl = function (t, e, i) { var n = this; this.authService.getWeixinAuthUrl(t, e, i, function (o) { o.isSuccess ? ($.cookie("SITESERVER.AUTH.WEIXINKEY", o.authKey, { expires: 7, path: "/", secure: !1 }), window.location.href = o.authUrl) : n.redirectToAuthUrl(t, e, i) }) }, t.prototype.redirectToThirdLoginAuthUrl = function (t, e, i) { var n = this; this.authService.getThirdLoginAuthUrl(t, e, i, function (o) { o.isSuccess ? ($.cookie("GEXIA.THIRDLOGIN.AUTH", o.authKey, { expires: 7, path: "/", secure: !1 }), window.location.href = o.authUrl) : Utils.alertError(StringUtils.Text.general.tip_third_login_error, function () { n.redirectToThirdLoginAuthUrl(t, e, i) }) }) }, t.prototype.submitLogin = function (t, e, i) { this.authService.login(t, e, function (t) { t.isSuccess ? (-1 != i.indexOf("shop.gexia.com") ? i = "http://shop.gexia.com/siteserver/integrationLogin.aspx?token=" + t.token : -1 != i.indexOf("bbs.gexia.com") && (i = "http://bbs.gexia.com/siteserver/integrationLogin.aspx?token=" + t.token), UrlUtils.redirect(i)) : Utils.alertError(t.errorMessage) }) }, t }(), IndexController = function (t) { function e() { t.call(this, "index") } return __extends(e, t), e.prototype.init = function () { this.render() }, e }(BaseController), LogoutController = function () { function t() { this.authService = new AuthService } return t.prototype.init = function () { Utils.render("public", {}), this.authService.logout(function () { HomeUrlUtils.redirectToReturnUrl() }) }, t }(), LoginController = function () { function t() { this.authService = new AuthService, this.sessionService = new SessionService, this.centralService = new CentralService } return t.prototype.init = function () { var t = this; Utils.render("public", {}), $(".reveal-modal").click(function (t) { t.stopPropagation() }), $(document).click(function () { Utils.unMask(), $(".reveal-modal").hide() }), $(".small-signin").click(function (e) { t.popLogin(), e.stopPropagation() }), $("#btnWeiboLogin").click(function () { t.redirectToThirdLoginUrl(StringUtils.ThirdLoginType.Weibo) }), $("#btnQQLogin").click(function () { t.redirectToThirdLoginUrl(StringUtils.ThirdLoginType.QQ) }), $("#btnWeiXinLogin").click(function () { t.redirectToThirdLoginUrl(Utils.isPc() ? StringUtils.ThirdLoginType.WeixinPC : StringUtils.ThirdLoginType.WeixinMob) }), $("#btnRegister").click(function () { t.submitLogin(!0) }), $("#btnLogin").click(function () { t.submitLogin(!1) }), $("#btnForget").click(function () { t.popForget() }), $("#btnForgetSubmit").click(function () { t.submitForget() }), $("#frmLogin").submit(function () { return t.submitLogin(!1), !1 }) }, t.prototype.popLogin = function () { $(".reveal-modal").hide(), $("#modal-login").show(), Utils.mask() }, t.prototype.popForget = function () { $(".reveal-modal").hide(), $("#modal-forget").show(), Utils.mask() }, t.prototype.redirectToThirdLoginUrl = function (t) { $.cookie("GEXIA.LOGIN", "YES", { expires: 7, path: "/", secure: !1 }), UrlUtils.redirect(UrlUtils.getThirdLoginUrl(t, HomeUrlUtils.getReturnUrl(HomeUrlUtils.getAbsoluteUrl("/home/index.html")))) }, t.prototype.submitLogin = function (t) { var e = this; $(".reveal-modal").hide(); { var i = $("#tbEmail").val(), n = $("#tbPassword").val(); $("#cbIsPersistent").is(":checked") } return i ? n ? void (t ? this.authService.register(i, n, function (t) { t.isSuccess ? Utils.alertSuccess(StringUtils.Text.login.tip_success_register, function () { e.popLogin() }) : Utils.alertError(t.errorMessage, function () { e.popLogin() }) }) : (HomeUtils.loading(), this.authService.login(i, n, function (t) { if (t.isSuccess) { var i = HomeUrlUtils.getReturnUrl(); -1 != i.indexOf("shop.gexia.com") ? i = "http://shop.gexia.com/siteserver/integrationLogin.aspx?token=" + t.token : -1 != i.indexOf("bbs.gexia.com") && (i = "http://bbs.gexia.com/siteserver/integrationLogin.aspx?token=" + t.token), UrlUtils.redirect(i) } else Utils.alertError(t.errorMessage, function () { e.popLogin() }) }))) : void Utils.alertError(StringUtils.Text.login.tip_empty_password, function () { e.popLogin() }) : void Utils.alertError(StringUtils.Text.login.tip_empty_login_name, function () { e.popLogin() }) }, t.prototype.submitForget = function () { var t = this; $(".reveal-modal").hide(); var e = $("#tbForgetEmail").val(); return e ? void this.authService.forgetPassword(e, function (e) { e.isSuccess ? Utils.alertSuccess(e.successMessage) : Utils.alertError(e.errorMessage, function () { t.popForget() }) }) : void Utils.alertError(StringUtils.Text.login.tip_empty_login_name, function () { t.popForget() }) }, t }(), TemplateController = function (t) { function e() { t.call(this, "template", HomeStringUtils.Text.app.title) } return __extends(e, t), e.prototype.init = function () { var t = this, e = UrlUtils.getUrlVar("templateType"); this.centralService.getTemplateList(e, function (i) { i.templateType = e, t.render(i, null, function () { $(".btnSelect").click(function () { var t = new SessionInfo; t.templateSN = $(this).data("sn"), HomeUtils.loading(), (new SessionService).submitH5Show(t, function (t) { t.isSuccess ? UrlUtils.redirect(HomeUrlUtils.getConsoleUrl(t.sn)) : Utils.alertError(t.errorMessage) }) }) }) }) }, e }(BaseController), SiteController = function (t) { function e() { t.call(this, "site", HomeStringUtils.Text.site.title) } return __extends(e, t), e.prototype.init = function () { var t = this; this.authService.getAuthPublishmentSystem(function (e) { t.render(e) }) }, e }(BaseController), H5ShowController = function (t) { function e() { t.call(this, "h5show", HomeStringUtils.Text.app.title) } return __extends(e, t), e.prototype.init = function () { var t = this; this.sessionService.getUserSessionList("", "H5Show", function (e) { e.isSuccess && t.render(e) }) }, e }(BaseController), ContentController = function (t) { function e() { t.call(this, "content", HomeStringUtils.Text.content.title) } return __extends(e, t), e.prototype.init = function () { t.prototype.render.call(this, {}) }, e }(BaseController); window.onload = function () { var t = window.location.hostname.toLowerCase(), e = window.location.pathname.toLowerCase(); ("www.gexia.com" === t || "gexia.com" === t) && ("/home/index.html" === e || "/home/" === e ? (new IndexController).init() : "/home/login.html" === e ? (new LoginController).init() : "/home/authlogin.html" === e ? (new AuthLoginController).init() : "/home/logout.html" === e ? (new LogoutController).init() : "/home/accountpassword.html" === e ? new AccountController("password").init() : "/home/accountbinding.html" === e ? new AccountController("binding").init() : "/home/accountsetting.html" === e ? new AccountController("setting").init() : "/home/template.html" === e ? (new TemplateController).init() : "/home/site.html" === e ? (new SiteController).init() : "/home/h5show.html" === e ? (new H5ShowController).init() : "/home/content.html" === e ? (new ContentController).init() : "/home/notice.html" === e && (new NoticeController).init()) }; var NoticeController = function (t) { function e() { t.call(this, "notice", HomeStringUtils.Text.notice.title) } return __extends(e, t), e.prototype.init = function () { var t = this, e = UrlUtils.getUrlVar("noticeType"); this.noticeService.getNoticeInfoList(e, function (e) { t.render(e) }) }, e }(BaseController), PageInfo = function () { function t(t, e, i, n) { this.pageName = t, this.pageTitle = e, this.isAnonymous = i, this.authInfo = n } return t }(), HomeStringUtils = function () { function t() { } return t.Text = { general: { tip_sn_error: "此内容已被作者删除或不存在", tip_login_first: "您还未登录，请登录后操作", tip_empty_comment: "请填写评论内容", tip_comfirm_delete: "此操作将删除内容，确定吗？", tip_success_delete: "内容已删除", tip_failure_private_code: "邀请码不正确，请重新输入", tip_error_email: "邮箱地址不正确，请重新输入", tip_success: "操作成功", btn_confirm: "确定", btn_cancel: "取消", app_name: "阁下", title_add: "新增", title_edit: "编辑" }, site: { title: "我的站点" }, app: { title: "我的场景" }, content: { title: "我的内容" }, notice: { title: "公告&帮助" }, account: { tip_current_password_empty: "请输入您当前使用的密码", tip_new_password_empty: "请输入您需要设置的密码", tip_comfirm_password_error: "您输入的新密码与确认密码不一致，请重新输入" } }, t }(), HomeUtils = function () {
    function t() { } return t.mask = function () { $(".mask").show() }, t.unMask = function () { $(".mask").hide() }, t.loading = function () { t.mask(), $("#loading").css("top", $(window).scrollTop() + $(window).height() / 3).show() }, t.unLoading = function () { t.unMask(), $("#loading").hide() }, t.render = function (e, i, n) {
        if (t.unLoading(), n) {
            $(".ID_" + n + "_HTML").remove();
            var o = $("#" + n).attr("path"), r = template(o, i), s = $("<div>" + r + "</div>"); s.children().addClass(e + "HTML"), s.children().addClass("ID_" + n + "_HTML"), $("#" + n).after(s.html())
        } else $("." + e + "_HTML").remove(), $("." + e).each(function () { var t = $(this).attr("id"), n = $(this).attr("path"), o = template(n, i), r = $("<div>" + o + "</div>"); r.children().addClass(e + "_HTML"), t && r.children().addClass("ID_" + t + "_HTML"), $(this).after(r.html()) })
    }, t
}(), HomeUrlUtils = function () { function t() { } return t.getAPI = function (e, i, n) { return n ? t.apiUrl + e + "/" + i + "/" + n : t.apiUrl + e + "/" + i }, t.getAbsoluteUrl = function (t) { return "http://" + window.location.hostname.toLowerCase() + "/" + t.replace(/(^\/*)|(\/*$)/g, "") }, t.getReturnUrl = function (t) { var e = new RegExp("(^|&)returnUrl=([^&]*)(&|$)"), i = window.location.search.substr(1).match(e); return null != i ? decodeURIComponent(i[2]) : t || "/index.html" }, t.getViewUrl = function (t, e) { return "/home/" + t + ".html?sn=" + e }, t.getUrlVar = function (t) { var e = new RegExp(t + "=([^&]*)", "i").exec(window.location.search); return e && decodeURIComponent(e[1]) || "" }, t.getSessionType = function () { return t.getUrlVar("sessionType") }, t.getSN = function () { return t.getUrlVar("sn") }, t.isSN = function () { return t.getSN() ? !0 : !1 }, t.getToken = function () { return t.getUrlVar("token") }, t.isToken = function () { return t.getToken() ? !0 : !1 }, t.redirectToReturnUrl = function (e) { location.href = t.getReturnUrl(e) }, t.redirectToIndex = function () { location.href = "/home/index.html" }, t.redirectToView = function (t, e) { location.href = "/home/" + t + ".html?sn=" + e }, t.redirectToEdit = function (t, e) { location.href = "/home/" + t + "Add.html?sn=" + e }, t.redirectToLogin = function (t) { t = t || window.location.href, location.href = "/home/login.html?returnUrl=" + t }, t.redirectToLoginToBind = function (t, e) { location.href = "/home/login.html?isBind=true&sessionType=" + t + "&sn=" + e }, t.redirectToUser = function (t) { location.href = "/home/user.html" + (t ? "?sn=" + t : "") }, t.redirectToActivityTicket = function (t, e) { location.href = "/home/activityTicket.html?sn=" + t + "&applyID=" + e }, t.getConsoleUrl = function (t) { return "/console/?sn=" + t }, t.reload = function () { location.reload(!0) }, t.apiUrl = "http://gexia.com/", t }();